<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tulip Tackers – Markermeer Party-Schleife (Seekarte, stabil)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height:100%; margin:0; }
    #map { height:100vh; width:100%; background:#eef3f8; }
    .toolbar { position:absolute; top:14px; left:50%; transform:translateX(-50%); z-index:1000; background:rgba(255,255,255,.96); border:1px solid #c6c6c6; box-shadow:0 2px 10px rgba(0,0,0,.08); border-radius:14px; padding:6px; font:14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .toolbar button { cursor:pointer; border:1px solid #c6c6c6; background:#fff; padding:8px 12px; border-radius:10px; margin:0 4px; }
    .toolbar button.active { background:#2b7bff; color:#fff; border-color:#2a6bd6; }
    .legend { position:absolute; bottom:14px; left:14px; background:rgba(255,255,255,.94); border:1px solid #c6c6c6; border-radius:10px; padding:10px 12px; font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; box-shadow:0 2px 10px rgba(0,0,0,.08); }
    .legend .swatch { display:inline-block; width:22px; height:5px; background:#1565c0; margin-right:6px; vertical-align:middle; border-radius:3px; box-shadow:0 0 0 2px rgba(21,101,192,.25); }
    .legend .swatch-alt { display:inline-block; width:22px; height:5px; background:#1565c0; border-bottom:2px dashed #1565c0; margin-right:6px; vertical-align:middle; }
    .lbl { background:rgba(255,255,255,.93); border:1px solid #bdbdbd; border-radius:6px; padding:4px 6px; font-size:12px; box-shadow:0 1px 6px rgba(0,0,0,.08); }
    .lbl small { color:#555; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="toolbar">
    <button id="btnA" class="active" title="Zeige Party-Schleife (Volendam)">Route A</button>
    <button id="btnB" title="Zeige Alternative über Urk">Route B</button>
  </div>
  <div class="legend">
    <strong>Tulip Tackers – Seekarte</strong><br/>
    <span class="swatch"></span> Party-Schleife: Lemmer → Hoorn → Amsterdam → Volendam → Lemmer<br/>
    <span class="swatch-alt"></span> Alternative: Amsterdam → Urk → Lemmer<br/>
    Basemap: Carto Voyager (Fallback: OSM) · Overlay: OpenSeaMap Seamarks
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ---- Häfen ----
    const ports = {
      Lemmer:    [52.846, 5.708],
      Hoorn:     [52.643, 5.071],
      Amsterdam: [52.383, 4.900], // grob Sixhaven
      Volendam:  [52.495, 5.073],
      Urk:       [52.664, 5.604]
    };

    // ---- Wasser-Route (Waypoints) ----
    const routeA_pts = [
      ports.Lemmer,
      [52.820, 5.530], [52.750, 5.350], [52.662, 5.200],
      ports.Hoorn,
      [52.610, 5.100], [52.580, 5.050], [52.510, 5.030],
      [52.450, 5.000], [52.400, 4.950],
      [52.372, 4.985],           // Oranjesluizen
      ports.Amsterdam,
      [52.372, 4.985],           // zurück durchs Schleusen-Gebiet
      [52.470, 5.030], [52.495, 5.060],
      ports.Volendam,
      [52.530, 5.100], [52.600, 5.200], [52.680, 5.400], [52.780, 5.550],
      ports.Lemmer
    ];
    const routeB_pts = [
      ports.Amsterdam, [52.372, 4.985],
      [52.520, 5.050], [52.600, 5.250], [52.630, 5.350],
      ports.Urk, [52.720, 5.520], [52.790, 5.600], ports.Lemmer
    ];

    // Distanzen (NM) – für Labels
    const dNM = {
      'Lemmer-Hoorn': 35,
      'Hoorn-Amsterdam': 30,
      'Amsterdam-Volendam': 15,
      'Volendam-Lemmer': 35,
      'Amsterdam-Urk': 40,
      'Urk-Lemmer': 20,
    };
    const timeRange = nm => `${(nm/7).toFixed(1)}–${(nm/6).toFixed(1)} h (7–6 kn)`;

    // ---- Karte + stabile Tiles mit Fallback ----
    const map = L.map('map', { zoomControl:true });
    const carto = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap & CARTO'
    });
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap-Mitwirkende'
    });
    // Start mit Carto; fallback auf OSM wenn ein Fehler auftritt
    carto.on('tileerror', () => { if (!map.hasLayer(osm)) { map.addLayer(osm); map.removeLayer(carto); } });
    carto.addTo(map);

    // Seamarks-Overlay (OpenSeaMap) – zeigt Tonnen/Leuchtfeuer/Fahrwasser
    const seamarks = L.tileLayer('https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', {
      maxZoom: 18, opacity: 0.95, attribution: '&copy; OpenSeaMap Contributors'
    }).addTo(map);

    L.control.layers(
      { 'Carto Voyager': carto, 'OpenStreetMap': osm },
      { 'OpenSeaMap Seamarks': seamarks },
      { collapsed: true }
    ).addTo(map);

    L.control.scale({ imperial:false }).addTo(map);

    // Hafenmarker
    const harborInfo = {
      Lemmer: 'Base: Enjoy Sailing',
      Hoorn: 'Grashaven • Binnenhaven/Oude Doelenkade',
      Amsterdam: 'Sixhaven / Amsterdam Marina · Oranjesluizen',
      Volendam: 'Marina Volendam',
      Urk: 'Urkerhaven'
    };
    const portMarkers = Object.entries(ports).map(([name, latlng]) =>
      L.marker(latlng).bindPopup(`<b>${name}</b><br/>${harborInfo[name]||''}`).bindTooltip(name)
    );

    // Routen + Labels
    function makeRoute(points, dashed=false) {
      return L.polyline(points, {
        color:'#1565c0', weight:5, opacity:0.95, lineCap:'round', lineJoin:'round',
        dashArray: dashed ? '10,8' : null
      });
    }
    const lineA = makeRoute(routeA_pts, false);
    const lineB = makeRoute(routeB_pts, true);

    function addLabelsA() {
      const pairs = [['Lemmer','Hoorn'],['Hoorn','Amsterdam'],['Amsterdam','Volendam'],['Volendam','Lemmer']];
      return pairs.map(([a,b])=>{
        const nm = dNM[`${a}-${b}`] || dNM[`${b}-${a}`];
        const pos=[ (ports[a][0]+ports[b][0])/2, (ports[a][1]+ports[b][1])/2 ];
        const html = `<div class="lbl"><b>${a} → ${b}</b><br/>${nm} sm · <small>${timeRange(nm)}</small></div>`;
        return L.marker(pos,{interactive:false,icon:L.divIcon({className:'',html})});
      });
    }
    const labelsA = addLabelsA();
    const labelsB = [
      L.marker([ (ports.Amsterdam[0]+ports.Urk[0])/2, (ports.Amsterdam[1]+ports.Urk[1])/2 ], {interactive:false, icon:L.divIcon({className:'', html:`<div class='lbl'><b>Amsterdam → Urk</b><br/>40 sm · <small>${timeRange(40)}</small></div>`})}),
      L.marker([ (ports.Urk[0]+ports.Lemmer[0])/2, (ports.Urk[1]+ports.Lemmer[1])/2 ], {interactive:false, icon:L.divIcon({className:'', html:`<div class='lbl'><b>Urk → Lemmer</b><br/>20 sm · <small>${timeRange(20)}</small></div>`})})
    ];

    // Layer-Gruppen
    const groupA = L.layerGroup([lineA, ...labelsA]).addTo(map);
    const groupB = L.layerGroup([lineB, ...labelsB]);
    portMarkers.forEach(m=>m.addTo(map));

    // Fit auf Revier / je Route
    function fitTo(layer) { map.fitBounds(layer.getBounds().pad(0.2)); }
    fitTo(groupA);

    // Toggle
    const btnA = document.getElementById('btnA');
    const btnB = document.getElementById('btnB');
    function activate(Aon){
      if (Aon) { btnA.classList.add('active'); btnB.classList.remove('active'); map.addLayer(groupA); map.removeLayer(groupB); fitTo(groupA); }
      else     { btnB.classList.add('active'); btnA.classList.remove('active'); map.addLayer(groupB); map.removeLayer(groupA); fitTo(groupB); }
    }
    btnA.addEventListener('click', ()=>activate(true));
    btnB.addEventListener('click', ()=>activate(false));
  </script>
</body>
</html>
