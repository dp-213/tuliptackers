<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tulip Tackers – Markermeer Party-Schleife</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-o9N1j7kG8GZQ2E2rU8WcJ6iYG3PaP8pKkG2JkG4bChg="
    crossorigin=""
  />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .legend { position: absolute; bottom: 16px; left: 16px; background: rgba(255,255,255,.92); border: 1px solid #888; border-radius: 8px; padding: 10px 12px; font: 13px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .legend .swatch { display:inline-block; width: 18px; height: 4px; background:#3388ff; margin-right:6px; vertical-align: middle; }
    .legend .swatch-alt { display:inline-block; width: 18px; height: 4px; background:#3388ff; border-bottom: 2px dashed #3388ff; margin-right:6px; vertical-align: middle; }
    .leaflet-popup-content { font-size: 14px; }
    .lbl { background: rgba(255,255,255,.88); border: 1px solid #999; border-radius: 6px; padding: 2px 6px; font-size: 12px; }
    .toolbar { position:absolute; top:16px; left:50%; transform:translateX(-50%); z-index:1000; background:rgba(255,255,255,.96); border:1px solid #888; border-radius:10px; padding:6px 8px; font: 13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .toolbar button { cursor:pointer; border:1px solid #888; background:#fff; padding:6px 10px; border-radius:8px; margin:0 4px; }
    .toolbar button.active { background:#3388ff; color:#fff; border-color:#2a6bd6; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="toolbar">
    <button id="btnA" class="active" title="Zeige Party-Schleife (Volendam)">Route A</button>
    <button id="btnB" title="Zeige Alternative über Urk">Route B</button>
  </div>
  <div class="legend">
    <strong>Tulip Tackers – Markermeer</strong><br/>
    <span class="swatch"></span> Party‑Schleife: Lemmer → Hoorn → Amsterdam → Volendam → Lemmer<br/>
    <span class="swatch-alt"></span> Alternative: Amsterdam → Urk → Lemmer<br/>
    Zeiten je Segment: Bereich für <b>7–6 kn</b>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-o9N1j7kG8GZQ2E2rU8WcJ6iYG3PaP8pKkG2JkG4bChg=" crossorigin=""></script>
  <script>
    // --- Konfiguration ---
    const ports = {
      Lemmer:    [52.846, 5.708],
      Hoorn:     [52.643, 5.071],
      Amsterdam: [52.379, 4.900],
      Volendam:  [52.495, 5.073],
      Urk:       [52.664, 5.604]
    };

    // Ca. Distanzen in sm (Segelrouten, nicht Luftlinie)
    const dNM = {
      'Lemmer-Hoorn': 35,
      'Hoorn-Amsterdam': 30,
      'Amsterdam-Volendam': 15,
      'Volendam-Lemmer': 35,
      'Amsterdam-Urk': 40,
      'Urk-Lemmer': 20,
    };

    const routeA = ['Lemmer','Hoorn','Amsterdam','Volendam','Lemmer'];
    const routeB = ['Amsterdam','Urk','Lemmer'];

    // Map
    const avg = arr => arr.reduce((a,b)=>a+b,0)/arr.length;
    const center = [avg(Object.values(ports).map(p=>p[0])), avg(Object.values(ports).map(p=>p[1]))];
    const map = L.map('map').setView(center, 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap-Mitwirkende'
    }).addTo(map);

    // Marker + Popups (mit Hafenempfehlungen)
    const harborInfo = {
      Lemmer: 'Base: Enjoy Sailing',
      Hoorn: 'Häfen: Grashaven (komfortabel) • Binnenhaven/Oude Doelenkade (zentral)',
      Amsterdam: 'Häfen: Sixhaven (zentral, eng) • Amsterdam Marina (groß, ruhig)',
      Volendam: 'Hafen: Marina Volendam (groß, nahe Partymeile)',
      Urk: 'Hafen: Urkerhaven (gemütlich, Fischeratmosphäre)'
    };

    Object.entries(ports).forEach(([name, latlng]) => {
      L.marker(latlng).addTo(map)
        .bindPopup(`<b>${name}</b><br/>${harborInfo[name] || ''}`)
        .bindTooltip(name);
    });

    function timeRange(nm) { // Stunden bei 7–6 kn
      const t7 = (nm/7).toFixed(1);
      const t6 = (nm/6).toFixed(1);
      return `${t7}–${t6} h (7–6 kn)`;
    }

    function midPoint(a, b) {
      return [ (a[0]+b[0])/2, (a[1]+b[1])/2 ];
    }

    function segmentLabel(aName, bName, color='#3388ff') {
      const key1 = `${aName}-${bName}`;
      const key2 = `${bName}-${aName}`;
      const nm = dNM[key1] || dNM[key2] || null;
      if (!nm) return null;

      const a = ports[aName];
      const b = ports[bName];
      const pos = midPoint(a,b);
      return L.marker(pos, {
        interactive:false,
        icon: L.divIcon({ className: 'lbl', html: `${aName} → ${bName}<br/>${nm} sm · ${timeRange(nm)}` })
      });
    }

    function makeRoute(names, dashed=false) {
      const coords = names.map(n => ports[n]);
      const line = L.polyline(coords, { color: '#3388ff', weight:4, opacity:0.9, dashArray: dashed ? '8,6' : null });
      const labels = names.slice(0,-1).map((n, i) => segmentLabel(n, names[i+1]));
      return { line, labels };
    }

    const A = makeRoute(routeA, false);
    const B = makeRoute(routeB, true);

    // Layer control via Buttons
    function showRoute(group) {
      // clear all
      map.eachLayer(l => { /* keep tile layer */ });
      // Remove existing route layers if present
      [A, B].forEach(R => {
        map.removeLayer(R.line);
        R.labels.forEach(lbl => lbl && map.removeLayer(lbl));
      });
      // Add desired
      map.addLayer(group.line);
      group.labels.forEach(lbl => lbl && map.addLayer(lbl));
      // Fit bounds
      map.fitBounds(group.line.getBounds().pad(0.15));
    }

    // Init with A
    showRoute(A);

    // Buttons
    const btnA = document.getElementById('btnA');
    const btnB = document.getElementById('btnB');
    btnA.addEventListener('click', () => { btnA.classList.add('active'); btnB.classList.remove('active'); showRoute(A); });
    btnB.addEventListener('click', () => { btnB.classList.add('active'); btnA.classList.remove('active'); showRoute(B); });
  </script>
</body>
</html>
